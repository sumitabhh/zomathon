<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KPT Signal Intelligence ‚Äî QuantumTrio</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root {
  --bg: #080C12;
  --surface: #0D1520;
  --surface2: #111B2A;
  --border: rgba(255,255,255,0.07);
  --accent: #FF4D00;
  --accent2: #00D4FF;
  --accent3: #7B61FF;
  --green: #00E5A0;
  --yellow: #FFB800;
  --red: #FF3366;
  --text: #E8EDF5;
  --muted: #6B7A94;
  --mono: 'Space Mono', monospace;
  --sans: 'DM Sans', sans-serif;
  --display: 'Syne', sans-serif;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  font-size: 14px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Grid background */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

.app { position: relative; z-index: 1; display: flex; min-height: 100vh; }

/* SIDEBAR */
.sidebar {
  width: 240px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  overflow-y: auto;
}
.sidebar-logo {
  padding: 24px 20px 20px;
  border-bottom: 1px solid var(--border);
}
.logo-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, var(--accent), #FF8C42);
  padding: 6px 12px;
  border-radius: 6px;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.08em;
  color: #fff;
  margin-bottom: 8px;
}
.logo-pulse {
  width: 6px; height: 6px;
  background: #fff;
  border-radius: 50%;
  animation: pulse 1.5s ease-in-out infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.8)} }
.sidebar-title {
  font-family: var(--display);
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  line-height: 1.3;
}
.sidebar-sub {
  font-size: 11px;
  color: var(--muted);
  margin-top: 2px;
  font-family: var(--mono);
}
.nav { padding: 16px 12px; flex: 1; }
.nav-section {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 0.12em;
  color: var(--muted);
  padding: 0 8px;
  margin-bottom: 8px;
  margin-top: 16px;
  text-transform: uppercase;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--muted);
  font-size: 13px;
  font-weight: 500;
  margin-bottom: 2px;
}
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item.active { background: rgba(255,77,0,0.12); color: var(--accent); border-left: 2px solid var(--accent); }
.nav-icon { font-size: 15px; width: 18px; text-align: center; }
.sidebar-team {
  padding: 16px 20px;
  border-top: 1px solid var(--border);
}
.team-label { font-size: 10px; color: var(--muted); font-family: var(--mono); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 6px; }
.team-name { font-family: var(--display); font-weight: 700; font-size: 13px; color: var(--accent2); }
.team-member { font-size: 11px; color: var(--muted); margin-top: 2px; }

/* MAIN CONTENT */
.main { margin-left: 240px; flex: 1; min-height: 100vh; }
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0; z-index: 50;
}
.topbar-title {
  font-family: var(--display);
  font-size: 16px;
  font-weight: 700;
}
.topbar-meta {
  display: flex;
  align-items: center;
  gap: 16px;
}
.status-badge {
  display: flex; align-items: center; gap: 6px;
  background: rgba(0,229,160,0.1);
  border: 1px solid rgba(0,229,160,0.2);
  color: var(--green);
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-family: var(--mono);
}
.status-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
.time-display { font-family: var(--mono); font-size: 12px; color: var(--muted); }

/* PAGES */
.page { display: none; padding: 32px; animation: fadeIn 0.3s ease; }
.page.active { display: block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

/* PAGE HEADER */
.page-header { margin-bottom: 28px; }
.page-eyebrow {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 0.15em;
  color: var(--accent);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.page-title {
  font-family: var(--display);
  font-size: 28px;
  font-weight: 800;
  line-height: 1.2;
}
.page-desc { color: var(--muted); font-size: 13px; margin-top: 6px; max-width: 600px; }

/* KPI CARDS */
.kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 28px; }
.kpi-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  position: relative;
  overflow: hidden;
  transition: border-color 0.2s;
}
.kpi-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  border-radius: 12px 12px 0 0;
}
.kpi-card.accent::before { background: linear-gradient(90deg, var(--accent), #FF8C42); }
.kpi-card.cyan::before { background: linear-gradient(90deg, var(--accent2), #0096CC); }
.kpi-card.purple::before { background: linear-gradient(90deg, var(--accent3), #5A44CC); }
.kpi-card.green::before { background: linear-gradient(90deg, var(--green), #00AA70); }
.kpi-card:hover { border-color: rgba(255,255,255,0.15); }
.kpi-label { font-size: 11px; color: var(--muted); font-family: var(--mono); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
.kpi-value {
  font-family: var(--display);
  font-size: 32px;
  font-weight: 800;
  line-height: 1;
  margin-bottom: 6px;
}
.kpi-change {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: 11px;
  font-family: var(--mono);
  padding: 2px 7px;
  border-radius: 4px;
}
.kpi-change.up { background: rgba(0,229,160,0.1); color: var(--green); }
.kpi-change.down { background: rgba(255,51,102,0.1); color: var(--red); }
.kpi-change.neutral { background: rgba(255,184,0,0.1); color: var(--yellow); }
.kpi-sub { font-size: 11px; color: var(--muted); margin-top: 4px; }

/* GRID LAYOUTS */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }

/* CHART CARDS */
.chart-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  overflow: hidden;
}
.chart-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
.chart-title {
  font-family: var(--display);
  font-size: 14px;
  font-weight: 700;
}
.chart-subtitle { font-size: 11px; color: var(--muted); margin-top: 2px; }
.chart-badge {
  font-family: var(--mono);
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 4px;
  background: rgba(0,212,255,0.1);
  color: var(--accent2);
  border: 1px solid rgba(0,212,255,0.2);
}
canvas { max-height: 260px; }

/* TABLE */
.table-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 20px;
}
.table-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.table-title { font-family: var(--display); font-size: 14px; font-weight: 700; }
.table-search {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 7px 12px;
  color: var(--text);
  font-family: var(--sans);
  font-size: 12px;
  width: 220px;
  outline: none;
  transition: border-color 0.2s;
}
.table-search:focus { border-color: rgba(0,212,255,0.4); }
.table-search::placeholder { color: var(--muted); }
.table-filters { display: flex; gap: 8px; }
.filter-select {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 7px 12px;
  color: var(--text);
  font-family: var(--sans);
  font-size: 12px;
  outline: none;
  cursor: pointer;
}
table { width: 100%; border-collapse: collapse; }
th {
  text-align: left;
  padding: 12px 16px;
  font-size: 10px;
  font-family: var(--mono);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--muted);
  border-bottom: 1px solid var(--border);
  background: rgba(255,255,255,0.02);
  white-space: nowrap;
}
td { padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 13px; }
tr:last-child td { border-bottom: none; }
tr:hover td { background: rgba(255,255,255,0.02); }

/* BADGES */
.badge {
  display: inline-flex; align-items: center;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-family: var(--mono);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.badge-green { background: rgba(0,229,160,0.12); color: var(--green); }
.badge-yellow { background: rgba(255,184,0,0.12); color: var(--yellow); }
.badge-red { background: rgba(255,51,102,0.12); color: var(--red); }
.badge-cyan { background: rgba(0,212,255,0.12); color: var(--accent2); }
.badge-orange { background: rgba(255,77,0,0.12); color: var(--accent); }
.badge-purple { background: rgba(123,97,255,0.12); color: var(--accent3); }

/* SIGNAL FLOW */
.signal-flow { display: flex; align-items: center; gap: 0; overflow-x: auto; padding: 20px 0; }
.signal-node {
  flex-shrink: 0;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 14px 18px;
  text-align: center;
  min-width: 120px;
  position: relative;
}
.signal-node.active-node { border-color: var(--accent2); background: rgba(0,212,255,0.05); }
.signal-node.transform-node { border-color: var(--accent3); background: rgba(123,97,255,0.05); }
.signal-node.output-node { border-color: var(--green); background: rgba(0,229,160,0.05); }
.signal-arrow {
  flex-shrink: 0;
  color: var(--muted);
  font-size: 18px;
  padding: 0 6px;
}
.signal-node-icon { font-size: 22px; margin-bottom: 6px; }
.signal-node-label { font-family: var(--mono); font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; }
.signal-node-name { font-family: var(--display); font-size: 12px; font-weight: 700; margin-top: 2px; }

/* METRIC COMPARISON */
.metric-compare {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 12px;
  align-items: center;
  margin-bottom: 12px;
}
.metric-before, .metric-after {
  background: var(--surface2);
  border-radius: 8px;
  padding: 12px 16px;
}
.metric-before { border-left: 3px solid var(--red); }
.metric-after { border-left: 3px solid var(--green); }
.metric-label { font-size: 10px; color: var(--muted); font-family: var(--mono); text-transform: uppercase; letter-spacing: 0.08em; }
.metric-val { font-family: var(--display); font-size: 22px; font-weight: 800; margin: 4px 0; }
.metric-val.before-val { color: var(--red); }
.metric-val.after-val { color: var(--green); }
.metric-unit { font-size: 11px; color: var(--muted); }
.metric-arrow { text-align: center; font-size: 20px; color: var(--muted); }
.improvement-badge {
  text-align: center;
  background: rgba(0,229,160,0.1);
  border: 1px solid rgba(0,229,160,0.2);
  color: var(--green);
  padding: 3px 10px;
  border-radius: 20px;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  white-space: nowrap;
}

/* PREDICTOR */
.predictor-form { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px; }
.form-group label { display: block; font-size: 11px; color: var(--muted); font-family: var(--mono); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 6px; }
.form-control {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  color: var(--text);
  font-family: var(--sans);
  font-size: 13px;
  outline: none;
  transition: border-color 0.2s;
}
.form-control:focus { border-color: rgba(0,212,255,0.4); }
.form-control option { background: var(--surface); }
.btn-predict {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, var(--accent), #FF8C42);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 13px 24px;
  font-family: var(--display);
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 0.03em;
}
.btn-predict:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(255,77,0,0.3); }
.btn-predict:active { transform: translateY(0); }

.prediction-result {
  background: var(--surface2);
  border: 1px solid rgba(0,229,160,0.2);
  border-radius: 12px;
  padding: 24px;
  display: none;
}
.prediction-result.visible { display: block; animation: fadeIn 0.3s ease; }
.pred-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 16px; }
.pred-item { text-align: center; }
.pred-label { font-size: 10px; color: var(--muted); font-family: var(--mono); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px; }
.pred-value { font-family: var(--display); font-size: 24px; font-weight: 800; }
.pred-unit { font-size: 11px; color: var(--muted); }

/* RUSH INDEX */
.rush-bar-container { margin-bottom: 10px; }
.rush-bar-label { display: flex; justify-content: space-between; margin-bottom: 4px; }
.rush-bar-name { font-size: 12px; font-weight: 500; }
.rush-bar-val { font-family: var(--mono); font-size: 11px; color: var(--muted); }
.rush-bar-track { height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden; }
.rush-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

/* LOADING */
.loading {
  display: flex; align-items: center; justify-content: center;
  padding: 60px;
  color: var(--muted);
  font-family: var(--mono);
  font-size: 12px;
  gap: 10px;
}
.spinner {
  width: 16px; height: 16px;
  border: 2px solid var(--border);
  border-top-color: var(--accent2);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* SCROLLBAR */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

/* PAGINATION */
.pagination { display: flex; justify-content: flex-end; gap: 6px; padding: 14px 16px; border-top: 1px solid var(--border); }
.page-btn {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 5px 12px;
  color: var(--muted);
  font-family: var(--mono);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.15s;
}
.page-btn:hover, .page-btn.current { background: rgba(0,212,255,0.1); color: var(--accent2); border-color: rgba(0,212,255,0.3); }

/* TIMELINE */
.timeline-item {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 12px;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.timeline-indicator {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.timeline-text { font-size: 12px; }
.timeline-time { font-family: var(--mono); font-size: 11px; color: var(--muted); }

/* ARCHITECTURE DIAGRAM */
.arch-layer {
  display: flex; gap: 10px; align-items: center;
  margin-bottom: 8px;
}
.arch-layer-label {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  width: 80px;
  flex-shrink: 0;
  text-align: right;
}
.arch-nodes { display: flex; gap: 8px; flex: 1; }
.arch-node {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 11px;
  flex: 1;
  text-align: center;
  transition: all 0.2s;
}
.arch-node:hover { transform: translateY(-2px); }
.arch-node.l1 { border-color: rgba(255,77,0,0.3); color: var(--accent); }
.arch-node.l2 { border-color: rgba(0,212,255,0.3); color: var(--accent2); }
.arch-node.l3 { border-color: rgba(123,97,255,0.3); color: var(--accent3); }
.arch-node.l4 { border-color: rgba(0,229,160,0.3); color: var(--green); }
.arch-connector {
  text-align: center;
  color: var(--muted);
  font-size: 16px;
  margin: 2px 0 2px 88px;
}

/* RESPONSIVE HELPERS */
.full-width { grid-column: 1 / -1; }
.text-right { text-align: right; }
.text-center { text-align: center; }
.text-muted { color: var(--muted); }
.text-green { color: var(--green); }
.text-red { color: var(--red); }
.text-yellow { color: var(--yellow); }
.text-cyan { color: var(--accent2); }
.text-accent { color: var(--accent); }
.font-mono { font-family: var(--mono); }
.font-display { font-family: var(--display); }
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mb-16 { margin-bottom: 16px; }

/* DETAIL MODAL OVERLAY */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 200;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(4px);
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 90%;
  max-width: 700px;
  max-height: 80vh;
  overflow-y: auto;
  padding: 28px;
  animation: fadeIn 0.3s ease;
}
.modal-close {
  float: right;
  background: var(--surface2);
  border: 1px solid var(--border);
  color: var(--muted);
  border-radius: 6px;
  padding: 4px 10px;
  cursor: pointer;
  font-family: var(--mono);
  font-size: 12px;
  transition: all 0.15s;
}
.modal-close:hover { color: var(--text); background: rgba(255,255,255,0.05); }
</style>
</head>
<body>
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-badge"><div class="logo-pulse"></div>LIVE</div>
    <div class="sidebar-title">KPT Signal<br>Intelligence</div>
    <div class="sidebar-sub">QuantumTrio v1.0</div>
  </div>
  <nav class="nav">
    <div class="nav-section">Core</div>
    <div class="nav-item active" onclick="navigate('overview')">
      <span class="nav-icon">‚ö°</span> System Overview
    </div>
    <div class="nav-item" onclick="navigate('predictor')">
      <span class="nav-icon">üéØ</span> KPT Predictor
    </div>
    <div class="nav-item" onclick="navigate('simulation')">
      <span class="nav-icon">üìä</span> Signal Simulation
    </div>

    <div class="nav-section">Intelligence</div>
    <div class="nav-item" onclick="navigate('restaurants')">
      <span class="nav-icon">üè™</span> Restaurant Profiles
    </div>
    <div class="nav-item" onclick="navigate('bias')">
      <span class="nav-icon">üîç</span> Bias Detection
    </div>
    <div class="nav-item" onclick="navigate('rush')">
      <span class="nav-icon">üî•</span> Kitchen Rush Index
    </div>

    <div class="nav-section">Analytics</div>
    <div class="nav-item" onclick="navigate('cities')">
      <span class="nav-icon">üèôÔ∏è</span> City Analytics
    </div>
    <div class="nav-item" onclick="navigate('patterns')">
      <span class="nav-icon">‚è±Ô∏è</span> Hourly Patterns
    </div>
    <div class="nav-section">Architecture</div>
    <div class="nav-item" onclick="navigate('architecture')">
      <span class="nav-icon">üèóÔ∏è</span> System Design
    </div>
  </nav>
  <div class="sidebar-team">
    <div class="team-label">Team</div>
    <div class="team-name">QuantumTrio</div>
    <div class="team-member">üë©‚Äçüíº Pranamika Kalita</div>
    <div class="team-member">üë©‚Äçüíª Porinistha Barooa</div>
    <div class="team-member">üë®‚Äçüíª Sumitabh Shyamal</div>
  </div>
</aside>

<!-- MAIN CONTENT -->
<main class="main">
  <div class="topbar">
    <div class="topbar-title" id="pageTitle">System Overview</div>
    <div class="topbar-meta">
      <div class="status-badge"><div class="status-dot"></div> All Systems Operational</div>
      <div class="time-display" id="clockDisplay"></div>
    </div>
  </div>

  <!-- OVERVIEW PAGE -->
  <div class="page active" id="page-overview">
    <div class="page-header">
      <div class="page-eyebrow">QuantumTrio ¬∑ Problem Statement 1</div>
      <div class="page-title">KPT Signal Intelligence Platform</div>
      <div class="page-desc">Improving Kitchen Prep Time prediction accuracy through signal enrichment, bias correction, and adaptive restaurant profiling at Zomato scale.</div>
    </div>

    <div class="kpi-grid" id="kpiGrid">
      <div class="loading"><div class="spinner"></div> Loading metrics...</div>
    </div>

    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title">ETA Error Distribution ‚Äî Before vs After Correction</div>
            <div class="chart-subtitle">P50/P90 improvement after signal enrichment</div>
          </div>
          <div class="chart-badge">SIMULATION</div>
        </div>
        <canvas id="etaErrorChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title">Merchant Bias Type Distribution</div>
            <div class="chart-subtitle">Classification across all restaurants</div>
          </div>
        </div>
        <canvas id="biasDistChart"></canvas>
      </div>
    </div>

    <div class="grid-2-1">
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title">Signal Flow Architecture</div>
            <div class="chart-subtitle">From raw events to corrected KPT prediction</div>
          </div>
          <div class="chart-badge">LIVE PIPELINE</div>
        </div>
        <div class="signal-flow">
          <div class="signal-node active-node">
            <div class="signal-node-icon">üìã</div>
            <div class="signal-node-label">Input</div>
            <div class="signal-node-name">Order<br>Event</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node active-node">
            <div class="signal-node-icon">üì°</div>
            <div class="signal-node-label">Raw</div>
            <div class="signal-node-name">FOR<br>Signal</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node transform-node">
            <div class="signal-node-icon">üî¨</div>
            <div class="signal-node-label">Layer 2</div>
            <div class="signal-node-name">Bias<br>Detector</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node transform-node">
            <div class="signal-node-icon">‚öôÔ∏è</div>
            <div class="signal-node-label">Layer 3</div>
            <div class="signal-node-name">Rush<br>Engine</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node transform-node">
            <div class="signal-node-icon">üìä</div>
            <div class="signal-node-label">Layer 4</div>
            <div class="signal-node-name">Confidence<br>Scorer</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node output-node">
            <div class="signal-node-icon">üéØ</div>
            <div class="signal-node-label">Output</div>
            <div class="signal-node-name">Corrected<br>KPT</div>
          </div>
          <div class="signal-arrow">‚Üí</div>
          <div class="signal-node output-node">
            <div class="signal-node-icon">üõµ</div>
            <div class="signal-node-label">Action</div>
            <div class="signal-node-name">Rider<br>Dispatch</div>
          </div>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title">Signal Quality</div>
            <div class="chart-subtitle">Restaurant reliability distribution</div>
          </div>
        </div>
        <canvas id="signalQualityChart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <div>
          <div class="chart-title">Key Business Impact Metrics</div>
          <div class="chart-subtitle">Expected outcomes after full signal layer deployment</div>
        </div>
        <div class="chart-badge">PROJECTED</div>
      </div>
      <div id="impactMetrics" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- PREDICTOR PAGE -->
  <div class="page" id="page-predictor">
    <div class="page-header">
      <div class="page-eyebrow">Real-time Engine</div>
      <div class="page-title">Live KPT Predictor</div>
      <div class="page-desc">Enter order context to get bias-corrected Kitchen Prep Time with confidence scoring and rider dispatch recommendation.</div>
    </div>
    <div class="chart-card mb-16">
      <div class="chart-title" style="margin-bottom:16px">Order Context Input</div>
      <div class="predictor-form" id="predictorForm">
        <div class="form-group">
          <label>Restaurant ID</label>
          <input type="number" class="form-control" id="predRestId" value="1" min="1" max="500">
        </div>
        <div class="form-group">
          <label>Active Orders</label>
          <input type="number" class="form-control" id="predActiveOrders" value="6" min="1" max="20">
        </div>
        <div class="form-group">
          <label>Staff Count</label>
          <input type="number" class="form-control" id="predStaffCount" value="3" min="1" max="15">
        </div>
        <div class="form-group">
          <label>Distance (km)</label>
          <input type="number" class="form-control" id="predDistance" value="3.5" min="0.5" max="15" step="0.1">
        </div>
        <div class="form-group">
          <label>Peak Hour</label>
          <select class="form-control" id="predPeakHour">
            <option value="0">Off-Peak</option>
            <option value="1">Peak Hour (12-2pm, 7-9pm)</option>
          </select>
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <button class="btn-predict" onclick="runPrediction()">üéØ Predict KPT</button>
        </div>
      </div>
      <div class="prediction-result" id="predictionResult">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
          <div style="font-family:var(--display);font-size:16px;font-weight:700;">Prediction Result</div>
          <div id="predSignalBadge" class="badge"></div>
          <div id="predBiasTypeBadge" class="badge badge-cyan" style="margin-left:auto;"></div>
        </div>
        <div class="pred-grid">
          <div class="pred-item">
            <div class="pred-label">Raw KPT</div>
            <div class="pred-value text-muted" id="predRaw">--</div>
            <div class="pred-unit">minutes</div>
          </div>
          <div class="pred-item">
            <div class="pred-label">Corrected KPT</div>
            <div class="pred-value text-green" id="predCorrected">--</div>
            <div class="pred-unit">minutes</div>
          </div>
          <div class="pred-item">
            <div class="pred-label">Confidence</div>
            <div class="pred-value text-cyan" id="predConfidence">--</div>
            <div class="pred-unit">score</div>
          </div>
          <div class="pred-item">
            <div class="pred-label">Dispatch Offset</div>
            <div class="pred-value text-accent" id="predDispatch">--</div>
            <div class="pred-unit">minutes</div>
          </div>
        </div>
        <div style="margin-top:16px;padding:14px;background:rgba(0,229,160,0.05);border-radius:8px;border:1px solid rgba(0,229,160,0.15);">
          <span style="font-size:11px;color:var(--muted);font-family:var(--mono);">RIDER DISPATCH RECOMMENDATION ‚Üí </span>
          <span id="predRecommendation" style="font-size:13px;color:var(--green);font-weight:500;"></span>
        </div>
        <div style="margin-top:12px;display:flex;gap:12px;">
          <div style="flex:1;padding:12px;background:var(--surface2);border-radius:8px;text-align:center;">
            <div style="font-size:10px;color:var(--muted);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;">Load Index</div>
            <div id="predLoad" style="font-family:var(--display);font-size:18px;font-weight:700;"></div>
          </div>
          <div style="flex:1;padding:12px;background:var(--surface2);border-radius:8px;text-align:center;">
            <div style="font-size:10px;color:var(--muted);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;">Rush Index</div>
            <div id="predRush" style="font-family:var(--display);font-size:18px;font-weight:700;color:var(--yellow);"></div>
          </div>
          <div style="flex:1;padding:12px;background:var(--surface2);border-radius:8px;text-align:center;">
            <div style="font-size:10px;color:var(--muted);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;">Restaurant</div>
            <div id="predRestName" style="font-family:var(--display);font-size:13px;font-weight:700;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SIMULATION PAGE -->
  <div class="page" id="page-simulation">
    <div class="page-header">
      <div class="page-eyebrow">Signal Correction Engine</div>
      <div class="page-title">Before vs After Signal Correction</div>
      <div class="page-desc">Quantitative simulation of KPT error reduction after deploying the signal enrichment and bias correction pipeline.</div>
    </div>
    <div id="simContent"><div class="loading"><div class="spinner"></div> Running simulation...</div></div>
  </div>

  <!-- RESTAURANTS PAGE -->
  <div class="page" id="page-restaurants">
    <div class="page-header">
      <div class="page-eyebrow">Restaurant Intelligence</div>
      <div class="page-title">Restaurant Signal Profiles</div>
      <div class="page-desc">Per-restaurant reliability scoring, bias type classification, and KPT error analysis.</div>
    </div>
    <div class="table-card">
      <div class="table-header">
        <div class="table-title">All Restaurants</div>
        <div class="table-filters">
          <input type="text" class="table-search" id="restSearch" placeholder="Search restaurants..." oninput="loadRestaurants(1)">
          <select class="filter-select" id="restCityFilter" onchange="loadRestaurants(1)">
            <option value="">All Cities</option>
          </select>
          <select class="filter-select" id="restBiasFilter" onchange="loadRestaurants(1)">
            <option value="">All Bias Types</option>
            <option value="reliable">Reliable</option>
            <option value="rider_triggered">Rider-Triggered</option>
            <option value="systematic_delay">Systematic Delay</option>
            <option value="peak_manipulator">Peak Manipulator</option>
          </select>
        </div>
      </div>
      <div id="restTableBody">
        <div class="loading"><div class="spinner"></div> Loading restaurants...</div>
      </div>
      <div class="pagination" id="restPagination"></div>
    </div>
  </div>

  <!-- BIAS PAGE -->
  <div class="page" id="page-bias">
    <div class="page-header">
      <div class="page-eyebrow">Core Innovation</div>
      <div class="page-title">Merchant Bias Detection System</div>
      <div class="page-desc">The heart of our signal correction pipeline ‚Äî detecting and correcting rider-triggered FOR marking and systematic delay bias across all merchants.</div>
    </div>
    <div id="biasContent"><div class="loading"><div class="spinner"></div> Analyzing bias patterns...</div></div>
  </div>

  <!-- RUSH PAGE -->
  <div class="page" id="page-rush">
    <div class="page-header">
      <div class="page-eyebrow">Kitchen Load Intelligence</div>
      <div class="page-title">Kitchen Rush Index</div>
      <div class="page-desc">Approximating real kitchen load beyond Zomato-visible orders using observable signal proxies.</div>
    </div>
    <div id="rushContent"><div class="loading"><div class="spinner"></div> Computing rush indices...</div></div>
  </div>

  <!-- CITIES PAGE -->
  <div class="page" id="page-cities">
    <div class="page-header">
      <div class="page-eyebrow">National Scale</div>
      <div class="page-title">City-Level Analytics</div>
      <div class="page-desc">Signal quality and KPT accuracy breakdown across Tier 1 and Tier 2 Indian cities.</div>
    </div>
    <div id="citiesContent"><div class="loading"><div class="spinner"></div> Loading city data...</div></div>
  </div>

  <!-- PATTERNS PAGE -->
  <div class="page" id="page-patterns">
    <div class="page-header">
      <div class="page-eyebrow">Temporal Analysis</div>
      <div class="page-title">Hourly Signal Patterns</div>
      <div class="page-desc">Kitchen prep time, FOR bias, and rider idle patterns across 24 hours ‚Äî identifying peak-hour signal degradation.</div>
    </div>
    <div id="patternsContent"><div class="loading"><div class="spinner"></div> Loading patterns...</div></div>
  </div>

  <!-- ARCHITECTURE PAGE -->
  <div class="page" id="page-architecture">
    <div class="page-header">
      <div class="page-eyebrow">System Design</div>
      <div class="page-title">Production Architecture</div>
      <div class="page-desc">5-layer signal intelligence architecture designed for 300K+ merchants, 5M+ daily orders at national scale.</div>
    </div>
    <div id="archContent"></div>
  </div>

</main>
</div>

<!-- RESTAURANT DETAIL MODAL -->
<div class="modal-overlay" id="restaurantModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï Close</button>
    <div id="modalContent"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STATE & ROUTING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentPage = 'overview';
let restCurrentPage = 1;
let charts = {};

const PAGE_TITLES = {
  overview: 'System Overview',
  predictor: 'Live KPT Predictor',
  simulation: 'Signal Simulation',
  restaurants: 'Restaurant Profiles',
  bias: 'Bias Detection',
  rush: 'Kitchen Rush Index',
  cities: 'City Analytics',
  patterns: 'Hourly Patterns',
  architecture: 'System Architecture',
};

function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelector(`[onclick="navigate('${page}')"]`).classList.add('active');
  document.getElementById('pageTitle').textContent = PAGE_TITLES[page];
  currentPage = page;
  loadPage(page);
}

function loadPage(page) {
  const loaders = {
    simulation: loadSimulation,
    restaurants: () => loadRestaurants(1),
    bias: loadBiasPage,
    rush: loadRushPage,
    cities: loadCitiesPage,
    patterns: loadPatternsPage,
    architecture: loadArchitecture,
  };
  if (loaders[page]) loaders[page]();
}

// Clock
function updateClock() {
  const now = new Date();
  document.getElementById('clockDisplay').textContent =
    now.toLocaleTimeString('en-IN', {hour12: false}) + ' IST';
}
setInterval(updateClock, 1000);
updateClock();

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CHART HELPERS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CHART_DEFAULTS = {
  responsive: true,
  maintainAspectRatio: true,
  plugins: { legend: { labels: { color: '#6B7A94', font: { family: 'DM Sans', size: 12 } } } },
  scales: {
    x: { ticks: { color: '#6B7A94', font: { family: 'Space Mono', size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } },
    y: { ticks: { color: '#6B7A94', font: { family: 'Space Mono', size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } },
  }
};

function destroyChart(id) {
  if (charts[id]) { charts[id].destroy(); delete charts[id]; }
}

function biasColor(type) {
  const map = { reliable: '#00E5A0', rider_triggered: '#FF3366', systematic_delay: '#FFB800', peak_manipulator: '#7B61FF' };
  return map[type] || '#6B7A94';
}

function signalBadge(quality) {
  if (quality === 'HIGH') return '<span class="badge badge-green">HIGH</span>';
  if (quality === 'MEDIUM') return '<span class="badge badge-yellow">MEDIUM</span>';
  return '<span class="badge badge-red">LOW</span>';
}

function biasBadge(type) {
  const map = {
    reliable: 'badge-green',
    rider_triggered: 'badge-red',
    systematic_delay: 'badge-yellow',
    peak_manipulator: 'badge-purple',
  };
  const labels = {
    reliable: 'Reliable',
    rider_triggered: 'Rider-Triggered',
    systematic_delay: 'Systematic Delay',
    peak_manipulator: 'Peak Manipulator',
  };
  return `<span class="badge ${map[type] || 'badge-cyan'}">${labels[type] || type}</span>`;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// OVERVIEW PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadOverview() {
  const data = await fetch('/api/overview').then(r => r.json());
  const sim = await fetch('/api/simulation').then(r => r.json());
  const kpis = data.system_kpis;

  // KPI Grid
  const kpiGrid = document.getElementById('kpiGrid');
  kpiGrid.innerHTML = `
    <div class="kpi-card accent">
      <div class="kpi-label">Total Orders Analyzed</div>
      <div class="kpi-value text-accent">${kpis.total_orders.toLocaleString()}</div>
      <span class="kpi-change up">‚Üë Live Dataset</span>
      <div class="kpi-sub">${kpis.total_restaurants} restaurants</div>
    </div>
    <div class="kpi-card cyan">
      <div class="kpi-label">ETA Error P50 (Before)</div>
      <div class="kpi-value text-red">${kpis.eta_error_p50_before}m</div>
      <span class="kpi-change down">Before correction</span>
      <div class="kpi-sub">P90: ${kpis.eta_error_p90_before}m</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-label">ETA Error P50 (After)</div>
      <div class="kpi-value text-green">${kpis.eta_error_p50_after}m</div>
      <span class="kpi-change up">‚Üì ${sim.improvement.p50_reduction_pct}% improvement</span>
      <div class="kpi-sub">P90: ${kpis.eta_error_p90_after}m</div>
    </div>
    <div class="kpi-card purple">
      <div class="kpi-label">Avg Rider Idle Time</div>
      <div class="kpi-value text-yellow">${kpis.avg_idle_time}m</div>
      <span class="kpi-change neutral">‚Üì ${sim.improvement.rider_idle_reduction_pct}% projected</span>
      <div class="kpi-sub">Avg FOR Bias: ${kpis.avg_for_bias}m</div>
    </div>
  `;

  // ETA Error chart
  const simData = sim;
  destroyChart('etaError');
  const ctxEta = document.getElementById('etaErrorChart').getContext('2d');
  charts['etaError'] = new Chart(ctxEta, {
    type: 'bar',
    data: {
      labels: simData.before.histogram.buckets,
      datasets: [
        {
          label: 'Before Correction',
          data: simData.before.histogram.counts,
          backgroundColor: 'rgba(255,51,102,0.6)',
          borderColor: '#FF3366',
          borderWidth: 1,
        },
        {
          label: 'After Correction',
          data: simData.after.histogram.counts,
          backgroundColor: 'rgba(0,229,160,0.6)',
          borderColor: '#00E5A0',
          borderWidth: 1,
        },
      ]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, title: { display: true, text: 'KPT Error Bucket (min)', color: '#6B7A94', font: { size: 11 } } },
        y: { ...CHART_DEFAULTS.scales.y, title: { display: true, text: 'Order Count', color: '#6B7A94', font: { size: 11 } } },
      }
    }
  });

  // Bias distribution chart
  const biasData = kpis.bias_distribution;
  destroyChart('biasDist');
  const ctxBias = document.getElementById('biasDistChart').getContext('2d');
  charts['biasDist'] = new Chart(ctxBias, {
    type: 'doughnut',
    data: {
      labels: ['Reliable', 'Rider-Triggered', 'Systematic Delay', 'Peak Manipulator'],
      datasets: [{
        data: [
          biasData.reliable || 0,
          biasData.rider_triggered || 0,
          biasData.systematic_delay || 0,
          biasData.peak_manipulator || 0,
        ],
        backgroundColor: ['#00E5A0', '#FF3366', '#FFB800', '#7B61FF'],
        borderColor: '#0D1520',
        borderWidth: 3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: '#6B7A94', font: { family: 'DM Sans', size: 11 }, padding: 12 }
        }
      }
    }
  });

  // Signal quality pie
  const highQ = Math.round(kpis.total_restaurants * 0.35);
  const medQ = Math.round(kpis.total_restaurants * 0.42);
  const lowQ = kpis.total_restaurants - highQ - medQ;
  destroyChart('signalQuality');
  const ctxSQ = document.getElementById('signalQualityChart').getContext('2d');
  charts['signalQuality'] = new Chart(ctxSQ, {
    type: 'pie',
    data: {
      labels: ['HIGH', 'MEDIUM', 'LOW'],
      datasets: [{
        data: [highQ, medQ, lowQ],
        backgroundColor: ['rgba(0,229,160,0.7)', 'rgba(255,184,0,0.7)', 'rgba(255,51,102,0.7)'],
        borderColor: '#0D1520',
        borderWidth: 3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: '#6B7A94', font: { family: 'DM Sans', size: 11 } }
        }
      }
    }
  });

  // Impact metrics
  const imp = sim.improvement;
  document.getElementById('impactMetrics').innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:16px;">
      ${[
        ['ETA P50 Error', imp.p50_reduction_pct + '%', '‚Üì Reduction', 'text-green'],
        ['ETA P90 Error', imp.p90_reduction_pct + '%', '‚Üì Reduction', 'text-green'],
        ['Mean KPT Error', imp.mean_reduction_pct + '%', '‚Üì Reduction', 'text-green'],
        ['Rider Idle Time', imp.rider_idle_reduction_pct + '%', '‚Üì Reduction', 'text-yellow'],
        ['Order Cancellations', imp.cancellation_reduction_pct + '%', '‚Üì Reduction', 'text-accent'],
      ].map(([label, val, sub, cls]) => `
        <div style="background:var(--surface2);border-radius:10px;padding:16px;text-align:center;">
          <div style="font-size:10px;color:var(--muted);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;">${label}</div>
          <div style="font-family:var(--display);font-size:28px;font-weight:800;" class="${cls}">${val}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px;">${sub}</div>
        </div>
      `).join('')}
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PREDICTOR PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runPrediction() {
  const btn = document.querySelector('.btn-predict');
  btn.textContent = '‚è≥ Computing...';
  btn.disabled = true;

  const payload = {
    restaurant_id: parseInt(document.getElementById('predRestId').value),
    active_orders: parseInt(document.getElementById('predActiveOrders').value),
    staff_count: parseInt(document.getElementById('predStaffCount').value),
    distance_km: parseFloat(document.getElementById('predDistance').value),
    peak_hour: parseInt(document.getElementById('predPeakHour').value),
  };

  const res = await fetch('/api/predict-kpt', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload),
  }).then(r => r.json());

  document.getElementById('predRaw').textContent = res.raw_kpt_minutes;
  document.getElementById('predCorrected').textContent = res.corrected_kpt_minutes;
  document.getElementById('predConfidence').textContent = res.confidence_score.toFixed(2);
  document.getElementById('predDispatch').textContent = res.recommended_rider_dispatch_offset;
  document.getElementById('predRecommendation').textContent = res.eta_recommendation;
  document.getElementById('predLoad').textContent = res.load_index;
  document.getElementById('predRush').textContent = res.rush_index;
  document.getElementById('predRestName').textContent = res.restaurant_name;

  const qMap = { HIGH: 'badge-green', MEDIUM: 'badge-yellow', LOW: 'badge-red' };
  document.getElementById('predSignalBadge').innerHTML = `<span class="badge ${qMap[res.signal_quality]}">${res.signal_quality} SIGNAL</span>`;
  document.getElementById('predBiasTypeBadge').innerHTML = biasBadge(res.detected_bias_type);

  document.getElementById('predictionResult').classList.add('visible');
  btn.textContent = 'üéØ Predict KPT';
  btn.disabled = false;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SIMULATION PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadSimulation() {
  const sim = await fetch('/api/simulation').then(r => r.json());
  const imp = sim.improvement;

  document.getElementById('simContent').innerHTML = `
    <div class="grid-2" style="margin-bottom:20px;">
      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title">KPT Prediction Error Distribution</div>
            <div class="chart-subtitle">Histogram of absolute prediction errors (minutes)</div>
          </div>
          <div class="chart-badge">QUANTITATIVE</div>
        </div>
        <canvas id="simHistChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Key Improvement Metrics</div><div class="chart-subtitle">Signal enrichment impact summary</div></div></div>
        <div style="padding-top:8px;">
          ${[
            ['ETA Error P50', sim.before.p50, sim.after.p50, 'min', imp.p50_reduction_pct],
            ['ETA Error P75', sim.before.p75, sim.after.p75, 'min', null],
            ['ETA Error P90', sim.before.p90, sim.after.p90, 'min', imp.p90_reduction_pct],
            ['Mean Error', sim.before.mean, sim.after.mean, 'min', imp.mean_reduction_pct],
          ].map(([label, before, after, unit, pct]) => `
            <div class="metric-compare">
              <div class="metric-before">
                <div class="metric-label">${label} ‚Äî Before</div>
                <div class="metric-val before-val">${before}${unit}</div>
              </div>
              <div class="metric-arrow" style="text-align:center;">
                ${pct ? `<div class="improvement-badge">-${pct}%</div>` : '<span style="color:var(--muted)">‚Üí</span>'}
              </div>
              <div class="metric-after">
                <div class="metric-label">${label} ‚Äî After</div>
                <div class="metric-val after-val">${after}${unit}</div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-header">
        <div>
          <div class="chart-title">Business Impact Summary</div>
          <div class="chart-subtitle">Projected operational improvements post-deployment</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-top:8px;">
        ${[
          ['‚Üì Rider Idle Time', imp.rider_idle_reduction_pct + '%', 'Reduction in rider wait at pickup', 'text-green'],
          ['‚Üì ETA P90 Error', imp.p90_reduction_pct + '%', 'Tail error reduction', 'text-accent2'],
          ['‚Üì Cancellations', imp.cancellation_reduction_pct + '%', 'Fewer customer cancellations', 'text-yellow'],
          ['‚Üë FOR Reliability', '35%', 'Improvement in signal confidence', 'text-cyan'],
        ].map(([title, val, desc, cls]) => `
          <div style="background:var(--surface2);border-radius:10px;padding:20px;border-top:3px solid currentColor;" class="${cls}">
            <div style="font-family:var(--display);font-size:32px;font-weight:800;margin-bottom:6px;" class="${cls}">${val}</div>
            <div style="font-size:13px;font-weight:600;margin-bottom:4px;">${title}</div>
            <div style="font-size:11px;color:var(--muted);">${desc}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `;

  destroyChart('simHist');
  const ctx = document.getElementById('simHistChart').getContext('2d');
  charts['simHist'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sim.before.histogram.buckets,
      datasets: [
        { label: 'Before Correction', data: sim.before.histogram.counts, backgroundColor: 'rgba(255,51,102,0.55)', borderColor: '#FF3366', borderWidth: 1 },
        { label: 'After Correction', data: sim.after.histogram.counts, backgroundColor: 'rgba(0,229,160,0.55)', borderColor: '#00E5A0', borderWidth: 1 },
      ]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, stacked: false },
        y: { ...CHART_DEFAULTS.scales.y },
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RESTAURANTS PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadRestaurants(page = 1) {
  restCurrentPage = page;
  const search = document.getElementById('restSearch')?.value || '';
  const city = document.getElementById('restCityFilter')?.value || '';
  const bias = document.getElementById('restBiasFilter')?.value || '';

  const url = `/api/restaurants?page=${page}&per_page=15&search=${encodeURIComponent(search)}&city=${city}&bias=${bias}`;
  const data = await fetch(url).then(r => r.json());

  // Populate city filter if empty
  const cityFilter = document.getElementById('restCityFilter');
  if (cityFilter && cityFilter.options.length === 1) {
    data.cities.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      cityFilter.appendChild(opt);
    });
  }

  const tbody = document.getElementById('restTableBody');
  if (!data.restaurants.length) {
    tbody.innerHTML = '<div class="loading">No restaurants found</div>';
    return;
  }

  tbody.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>Restaurant</th>
          <th>City</th>
          <th>Signal Quality</th>
          <th>Bias Type</th>
          <th>FOR Bias (avg)</th>
          <th>True KPT (avg)</th>
          <th>Idle Time</th>
          <th>KPT Error %</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${data.restaurants.map(r => `
          <tr>
            <td>
              <div style="font-weight:600;">${r.restaurant_name}</div>
              <div style="font-size:11px;color:var(--muted);font-family:var(--mono);">ID: ${r.restaurant_id}</div>
            </td>
            <td>${r.city}</td>
            <td>${signalBadge(r.signal_quality)}</td>
            <td>${biasBadge(r.detected_bias_type)}</td>
            <td style="font-family:var(--mono);">
              <span class="${r.avg_for_bias > 3 ? 'text-red' : r.avg_for_bias > 1 ? 'text-yellow' : 'text-green'}">${r.avg_for_bias}m</span>
            </td>
            <td style="font-family:var(--mono);">${r.avg_true_kpt}m</td>
            <td style="font-family:var(--mono);">
              <span class="${r.avg_idle_time > 3 ? 'text-red' : r.avg_idle_time > 1.5 ? 'text-yellow' : 'text-green'}">${r.avg_idle_time}m</span>
            </td>
            <td>
              <div style="display:flex;align-items:center;gap:8px;">
                <div style="flex:1;max-width:60px;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden;">
                  <div style="height:100%;width:${Math.min(r.kpt_error_pct, 100)}%;background:${r.kpt_error_pct > 30 ? '#FF3366' : r.kpt_error_pct > 15 ? '#FFB800' : '#00E5A0'};border-radius:2px;"></div>
                </div>
                <span style="font-family:var(--mono);font-size:11px;">${r.kpt_error_pct}%</span>
              </div>
            </td>
            <td>
              <button onclick="viewRestaurant(${r.restaurant_id})" style="background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.3);color:var(--accent2);border-radius:5px;padding:4px 10px;cursor:pointer;font-size:11px;font-family:var(--mono);">View ‚Üí</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;

  // Pagination
  const totalPages = Math.ceil(data.total / data.per_page);
  const pagination = document.getElementById('restPagination');
  let pages = '';
  for (let i = 1; i <= Math.min(totalPages, 8); i++) {
    pages += `<button class="page-btn ${i === page ? 'current' : ''}" onclick="loadRestaurants(${i})">${i}</button>`;
  }
  pagination.innerHTML = `
    <button class="page-btn" onclick="loadRestaurants(${Math.max(1, page-1)})" ${page === 1 ? 'disabled style="opacity:0.4"' : ''}>‚Äπ Prev</button>
    ${pages}
    <button class="page-btn" onclick="loadRestaurants(${Math.min(totalPages, page+1)})" ${page === totalPages ? 'disabled style="opacity:0.4"' : ''}>Next ‚Ä∫</button>
    <span style="font-family:var(--mono);font-size:11px;color:var(--muted);padding:5px 8px;">${data.total} total</span>
  `;
}

async function viewRestaurant(id) {
  const data = await fetch(`/api/restaurant/${id}`).then(r => r.json());
  const { profile, restaurant, hourly_kpt } = data;
  document.getElementById('modalContent').innerHTML = `
    <div style="margin-bottom:20px;">
      <div style="font-family:var(--display);font-size:20px;font-weight:800;margin-bottom:4px;">${restaurant.restaurant_name}</div>
      <div style="font-size:12px;color:var(--muted);">${restaurant.cuisine_type} ¬∑ ${restaurant.city} ¬∑ ${restaurant.availability}</div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;">
      ${[
        ['Rating', restaurant.rating + ' ‚≠ê', ''],
        ['Price Range', restaurant.price_range, ''],
        ['Total Orders', restaurant.total_orders?.toLocaleString(), ''],
        ['Signal Quality', profile.signal_quality, ''],
        ['Avg FOR Bias', profile.avg_for_bias + 'm', profile.avg_for_bias > 3 ? 'text-red' : 'text-green'],
        ['Avg Idle Time', profile.avg_idle_time + 'm', profile.avg_idle_time > 3 ? 'text-red' : 'text-green'],
      ].map(([l, v, cls]) => `
        <div style="background:var(--surface2);border-radius:8px;padding:12px;">
          <div style="font-size:10px;color:var(--muted);font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;">${l}</div>
          <div style="font-family:var(--display);font-size:16px;font-weight:700;" class="${cls}">${v}</div>
        </div>
      `).join('')}
    </div>
    <div style="background:var(--surface2);border-radius:8px;padding:16px;margin-bottom:16px;">
      <div style="font-size:12px;font-weight:600;margin-bottom:12px;">Bias Profile</div>
      <div style="display:flex;align-items:center;gap:10px;">
        ${biasBadge(profile.detected_bias_type)}
        <span style="font-size:12px;color:var(--muted);">Detected bias type</span>
        <span style="margin-left:auto;font-family:var(--mono);font-size:11px;">Reliability: ${(1-profile.reliability_score).toFixed(2)}</span>
      </div>
    </div>
    <div style="font-size:12px;font-weight:600;margin-bottom:10px;">Hourly KPT Pattern</div>
    <div style="display:flex;gap:3px;align-items:flex-end;height:50px;">
      ${hourly_kpt.slice(0, 24).map(h => `
        <div title="${h.hour}:00 ‚Äî ${h.avg_kpt}m" style="flex:1;background:rgba(0,212,255,0.6);border-radius:2px 2px 0 0;min-height:4px;height:${Math.min(50, (h.avg_kpt / 40) * 50)}px;transition:height 0.3s;"></div>
      `).join('')}
    </div>
    <div style="display:flex;justify-content:space-between;font-family:var(--mono);font-size:10px;color:var(--muted);margin-top:4px;"><span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>23:00</span></div>
  `;
  document.getElementById('restaurantModal').classList.add('open');
}

function closeModal() {
  document.getElementById('restaurantModal').classList.remove('open');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// BIAS PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadBiasPage() {
  const data = await fetch('/api/bias-heatmap').then(r => r.json());

  document.getElementById('biasContent').innerHTML = `
    <div class="grid-2" style="margin-bottom:20px;">
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Merchant Bias Formula</div><div class="chart-subtitle">Core signal correction algorithm</div></div></div>
        <div style="background:var(--bg);border-radius:8px;padding:20px;font-family:var(--mono);font-size:12px;line-height:2;margin-top:8px;border:1px solid var(--border);">
          <div style="color:var(--muted);">// Step 1: Prep Gap Detection</div>
          <div><span style="color:var(--accent2);">prep_gap</span> = rider_arrival ‚àí merchant_FOR</div>
          <div style="color:var(--muted);margin-top:8px;">// Step 2: FOR Bias Classification</div>
          <div><span style="color:var(--accent2);">if</span> abs(prep_gap) < 1m ‚Üí <span style="color:var(--green);">RELIABLE</span></div>
          <div><span style="color:var(--accent2);">if</span> prep_gap ‚âà 0 consistently ‚Üí <span style="color:var(--red);">RIDER-TRIGGERED</span></div>
          <div><span style="color:var(--accent2);">if</span> FOR > actual consistently ‚Üí <span style="color:var(--yellow);">SYSTEMATIC DELAY</span></div>
          <div style="color:var(--muted);margin-top:8px;">// Step 3: Reliability Weight</div>
          <div><span style="color:var(--accent2);">weight</span> = 1 ‚àí normalize(|bias| + idle_time)</div>
          <div style="color:var(--muted);margin-top:8px;">// Step 4: Corrected KPT</div>
          <div><span style="color:var(--green);">corrected_kpt</span> = raw_kpt √ó weight ‚àí (bias √ó 0.7)</div>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">City Reliability Rates</div><div class="chart-subtitle">% of reliable restaurants per city</div></div></div>
        <canvas id="cityReliabilityChart"></canvas>
      </div>
    </div>
    <div class="table-card">
      <div class="table-header"><div class="table-title">City-wise Bias Distribution</div></div>
      <table>
        <thead>
          <tr>
            <th>City</th>
            <th>Total Restaurants</th>
            <th>Reliable</th>
            <th>Rider-Triggered</th>
            <th>Systematic Delay</th>
            <th>Peak Manipulator</th>
            <th>Reliability Rate</th>
          </tr>
        </thead>
        <tbody>
          ${data.heatmap.map(row => `
            <tr>
              <td style="font-weight:600;">${row.city}</td>
              <td style="font-family:var(--mono);">${row.total}</td>
              <td><span class="badge badge-green">${row.reliable}</span></td>
              <td><span class="badge badge-red">${row.rider_triggered}</span></td>
              <td><span class="badge badge-yellow">${row.systematic_delay}</span></td>
              <td><span class="badge badge-purple">${row.peak_manipulator}</span></td>
              <td>
                <div style="display:flex;align-items:center;gap:8px;">
                  <div style="width:60px;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden;">
                    <div style="height:100%;width:${row.reliability_rate}%;background:${row.reliability_rate > 60 ? '#00E5A0' : row.reliability_rate > 40 ? '#FFB800' : '#FF3366'};border-radius:2px;"></div>
                  </div>
                  <span style="font-family:var(--mono);font-size:11px;">${row.reliability_rate}%</span>
                </div>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;

  destroyChart('cityReliability');
  const ctx = document.getElementById('cityReliabilityChart').getContext('2d');
  charts['cityReliability'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.heatmap.map(r => r.city),
      datasets: [{
        label: 'Reliability Rate (%)',
        data: data.heatmap.map(r => r.reliability_rate),
        backgroundColor: data.heatmap.map(r =>
          r.reliability_rate > 60 ? 'rgba(0,229,160,0.7)' :
          r.reliability_rate > 40 ? 'rgba(255,184,0,0.7)' : 'rgba(255,51,102,0.7)'
        ),
        borderRadius: 4,
      }]
    },
    options: {
      ...CHART_DEFAULTS,
      plugins: { legend: { display: false } },
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, ticks: { ...CHART_DEFAULTS.scales.x.ticks, maxRotation: 45 } },
        y: { ...CHART_DEFAULTS.scales.y, min: 0, max: 100 }
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RUSH INDEX PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadRushPage() {
  const data = await fetch('/api/rush-index').then(r => r.json());

  document.getElementById('rushContent').innerHTML = `
    <div class="grid-2" style="margin-bottom:20px;">
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Rush Multiplier ‚Äî Top Restaurants</div><div class="chart-subtitle">Peak vs off-peak KPT ratio</div></div></div>
        <canvas id="rushChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Rush Index Formula</div><div class="chart-subtitle">Kitchen load beyond Zomato orders</div></div></div>
        <div style="background:var(--bg);border-radius:8px;padding:20px;font-family:var(--mono);font-size:12px;line-height:2.2;margin-top:8px;border:1px solid var(--border);">
          <div style="color:var(--muted);">// Observable proxy signals for total kitchen load</div>
          <div><span style="color:var(--yellow);">rush_index</span> =</div>
          <div style="padding-left:16px;"><span style="color:var(--accent2);">load_index</span> √ó load_weight (0.35)</div>
          <div style="padding-left:16px;">+ <span style="color:var(--accent2);">peak_hour_flag</span> √ó peak_weight (0.25)</div>
          <div style="padding-left:16px;">+ <span style="color:var(--accent2);">city_congestion</span> √ó city_weight (0.20)</div>
          <div style="padding-left:16px;">+ <span style="color:var(--accent2);">prep_variance_spike</span> √ó var_weight (0.20)</div>
          <div style="margin-top:8px;color:var(--muted);">// Captures dine-in & competitor load indirectly</div>
          <div style="margin-top:8px;padding:10px;background:rgba(255,184,0,0.08);border-radius:6px;border:1px solid rgba(255,184,0,0.2);">
            <span style="color:var(--yellow);">If rush_index > 1.5 ‚Üí delay rider dispatch by +3-5 min</span>
          </div>
        </div>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-header"><div><div class="chart-title">High Rush Restaurants</div><div class="chart-subtitle">Peak vs off-peak comparison</div></div></div>
      <div style="padding:8px 0;">
        ${data.rush_data.slice(0, 12).map(r => `
          <div class="rush-bar-container">
            <div class="rush-bar-label">
              <span class="rush-bar-name">${r.restaurant_name} <span style="font-size:10px;color:var(--muted);">(${r.city})</span></span>
              <span class="rush-bar-val">√ó${r.rush_multiplier} | Peak: ${r.peak_kpt}m / Off: ${r.off_peak_kpt}m</span>
            </div>
            <div class="rush-bar-track">
              <div class="rush-bar-fill" style="width:${Math.min(100, (r.rush_multiplier / 2.5) * 100)}%;background:${r.rush_multiplier > 1.8 ? '#FF3366' : r.rush_multiplier > 1.4 ? '#FFB800' : '#00E5A0'};"></div>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
  `;

  destroyChart('rush');
  const ctx = document.getElementById('rushChart').getContext('2d');
  charts['rush'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: data.rush_data.slice(0, 10).map(r => r.restaurant_name.slice(0, 14) + '‚Ä¶'),
      datasets: [
        { label: 'Peak KPT (min)', data: data.rush_data.slice(0, 10).map(r => r.peak_kpt), backgroundColor: 'rgba(255,51,102,0.7)', borderRadius: 4 },
        { label: 'Off-Peak KPT (min)', data: data.rush_data.slice(0, 10).map(r => r.off_peak_kpt), backgroundColor: 'rgba(0,229,160,0.7)', borderRadius: 4 },
      ]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, ticks: { ...CHART_DEFAULTS.scales.x.ticks, maxRotation: 30 } },
        y: { ...CHART_DEFAULTS.scales.y }
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CITIES PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadCitiesPage() {
  const data = await fetch('/api/city-analytics').then(r => r.json());

  document.getElementById('citiesContent').innerHTML = `
    <div class="grid-2" style="margin-bottom:20px;">
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Avg KPT by City</div><div class="chart-subtitle">True kitchen prep time comparison</div></div></div>
        <canvas id="cityKptChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Rush Index by City</div><div class="chart-subtitle">Composite load score</div></div></div>
        <canvas id="cityRushChart"></canvas>
      </div>
    </div>
    <div class="table-card">
      <div class="table-header"><div class="table-title">National City Intelligence</div></div>
      <table>
        <thead>
          <tr><th>City</th><th>Tier</th><th>Orders</th><th>Avg True KPT</th><th>Avg FOR Bias</th><th>Avg Rider Idle</th><th>Congestion Index</th><th>Rush Index</th></tr>
        </thead>
        <tbody>
          ${data.cities.map(c => `
            <tr>
              <td style="font-weight:600;">${c.city}</td>
              <td><span class="badge ${c.tier === 1 ? 'badge-orange' : 'badge-cyan'}">TIER ${c.tier}</span></td>
              <td style="font-family:var(--mono);">${c.order_count}</td>
              <td style="font-family:var(--mono);">${c.avg_true_kpt}m</td>
              <td style="font-family:var(--mono);"><span class="${c.avg_for_bias > 3 ? 'text-red' : c.avg_for_bias > 1 ? 'text-yellow' : 'text-green'}">${c.avg_for_bias}m</span></td>
              <td style="font-family:var(--mono);">${c.avg_idle_time}m</td>
              <td>
                <div style="display:flex;align-items:center;gap:6px;">
                  <div style="width:50px;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden;"><div style="height:100%;width:${c.congestion_index*100}%;background:${c.congestion_index>0.7?'#FF3366':c.congestion_index>0.5?'#FFB800':'#00E5A0'};border-radius:2px;"></div></div>
                  <span style="font-family:var(--mono);font-size:11px;">${(c.congestion_index*100).toFixed(0)}%</span>
                </div>
              </td>
              <td style="font-family:var(--mono);color:var(--yellow);">${c.rush_index}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;

  destroyChart('cityKpt');
  const ctx1 = document.getElementById('cityKptChart').getContext('2d');
  charts['cityKpt'] = new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: data.cities.map(c => c.city),
      datasets: [{
        label: 'Avg True KPT (min)',
        data: data.cities.map(c => c.avg_true_kpt),
        backgroundColor: data.cities.map(c => c.tier === 1 ? 'rgba(255,77,0,0.7)' : 'rgba(0,212,255,0.7)'),
        borderRadius: 4,
      }]
    },
    options: { ...CHART_DEFAULTS, plugins: { legend: { display: false } } }
  });

  destroyChart('cityRush');
  const ctx2 = document.getElementById('cityRushChart').getContext('2d');
  charts['cityRush'] = new Chart(ctx2, {
    type: 'radar',
    data: {
      labels: data.cities.slice(0, 8).map(c => c.city),
      datasets: [{
        label: 'Rush Index',
        data: data.cities.slice(0, 8).map(c => c.rush_index),
        backgroundColor: 'rgba(255,184,0,0.15)',
        borderColor: '#FFB800',
        pointBackgroundColor: '#FFB800',
        pointRadius: 4,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: true,
      plugins: { legend: { labels: { color: '#6B7A94' } } },
      scales: {
        r: {
          grid: { color: 'rgba(255,255,255,0.06)' },
          angleLines: { color: 'rgba(255,255,255,0.06)' },
          pointLabels: { color: '#6B7A94', font: { size: 10 } },
          ticks: { color: '#6B7A94', backdropColor: 'transparent', font: { size: 9 } }
        }
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HOURLY PATTERNS PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadPatternsPage() {
  const data = await fetch('/api/hourly-patterns').then(r => r.json());

  document.getElementById('patternsContent').innerHTML = `
    <div class="chart-card" style="margin-bottom:20px;">
      <div class="chart-header"><div><div class="chart-title">KPT, FOR Bias & Rider Idle ‚Äî 24-Hour Profile</div><div class="chart-subtitle">Signal degradation patterns across the day</div></div><div class="chart-badge">24HR ANALYSIS</div></div>
      <canvas id="hourlyLineChart" style="max-height:300px;"></canvas>
    </div>
    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Peak Hour Impact</div><div class="chart-subtitle">Order volume distribution</div></div></div>
        <canvas id="hourlyOrdersChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Bias Surge Hours</div><div class="chart-subtitle">When FOR signal quality degrades most</div></div></div>
        <canvas id="hourlyBiasChart"></canvas>
      </div>
    </div>
  `;

  const patterns = data.patterns;
  const hours = patterns.map(p => p.hour_label || `${String(p.hour).padStart(2,'0')}:00`);

  destroyChart('hourlyLine');
  const ctx = document.getElementById('hourlyLineChart').getContext('2d');
  charts['hourlyLine'] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: hours,
      datasets: [
        { label: 'Avg True KPT (min)', data: patterns.map(p => p.avg_kpt), borderColor: '#00D4FF', backgroundColor: 'rgba(0,212,255,0.08)', tension: 0.4, fill: true, pointRadius: 3 },
        { label: 'Avg FOR Bias (min)', data: patterns.map(p => p.avg_bias), borderColor: '#FF3366', backgroundColor: 'rgba(255,51,102,0.08)', tension: 0.4, fill: true, pointRadius: 3 },
        { label: 'Avg Rider Idle (min)', data: patterns.map(p => p.avg_idle), borderColor: '#FFB800', backgroundColor: 'rgba(255,184,0,0.08)', tension: 0.4, fill: true, pointRadius: 3 },
      ]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, ticks: { ...CHART_DEFAULTS.scales.x.ticks, maxRotation: 45 } },
        y: { ...CHART_DEFAULTS.scales.y }
      }
    }
  });

  destroyChart('hourlyOrders');
  const ctx2 = document.getElementById('hourlyOrdersChart').getContext('2d');
  charts['hourlyOrders'] = new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: hours,
      datasets: [{
        label: 'Order Count',
        data: patterns.map(p => p.order_count),
        backgroundColor: patterns.map(p => p.is_peak ? 'rgba(255,77,0,0.8)' : 'rgba(0,212,255,0.4)'),
        borderRadius: 2,
      }]
    },
    options: { ...CHART_DEFAULTS, plugins: { legend: { display: false } } }
  });

  destroyChart('hourlyBias');
  const ctx3 = document.getElementById('hourlyBiasChart').getContext('2d');
  charts['hourlyBias'] = new Chart(ctx3, {
    type: 'bar',
    data: {
      labels: hours,
      datasets: [{
        label: 'Avg FOR Bias (min)',
        data: patterns.map(p => p.avg_bias),
        backgroundColor: patterns.map(p => p.avg_bias > 4 ? 'rgba(255,51,102,0.8)' : p.avg_bias > 2 ? 'rgba(255,184,0,0.8)' : 'rgba(0,229,160,0.6)'),
        borderRadius: 2,
      }]
    },
    options: { ...CHART_DEFAULTS, plugins: { legend: { display: false } } }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ARCHITECTURE PAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadArchitecture() {
  document.getElementById('archContent').innerHTML = `
    <div class="chart-card" style="margin-bottom:20px;">
      <div class="chart-header"><div><div class="chart-title">5-Layer Signal Intelligence Architecture</div><div class="chart-subtitle">Production system for 300K+ merchants ¬∑ 5M+ daily orders</div></div><div class="chart-badge">PRODUCTION DESIGN</div></div>

      <div style="margin-top:20px;">
        <div class="arch-layer">
          <div class="arch-layer-label">Layer 1</div>
          <div class="arch-nodes">
            <div class="arch-node l1">üìã Order Events</div>
            <div class="arch-node l1">üì° Rider GPS Events</div>
            <div class="arch-node l1">üè™ Merchant Mx App</div>
            <div class="arch-node l1">‚ö° Kafka Streaming</div>
            <div class="arch-node l1">üåê External Enrichment</div>
          </div>
        </div>
        <div class="arch-connector">‚Üì Data Ingestion Pipeline</div>

        <div class="arch-layer">
          <div class="arch-layer-label">Layer 2</div>
          <div class="arch-nodes">
            <div class="arch-node l2">üïê Time Alignment</div>
            <div class="arch-node l2">üî¨ Merchant Bias Profiler</div>
            <div class="arch-node l2">üìä Prep Gap Engine</div>
            <div class="arch-node l2">‚è±Ô∏è Idle Signal Analyzer</div>
          </div>
        </div>
        <div class="arch-connector">‚Üì Signal Enrichment & Bias Detection</div>

        <div class="arch-layer">
          <div class="arch-layer-label">Layer 3</div>
          <div class="arch-nodes">
            <div class="arch-node l3">üî• Kitchen Rush Index</div>
            <div class="arch-node l3">üèôÔ∏è City Scale Adapter</div>
            <div class="arch-node l3">üìà Load Index Computer</div>
            <div class="arch-node l3">üå¶Ô∏è External Signal Injector</div>
          </div>
        </div>
        <div class="arch-connector">‚Üì Feature Engineering</div>

        <div class="arch-layer">
          <div class="arch-layer-label">Layer 4</div>
          <div class="arch-nodes">
            <div class="arch-node l4">‚úÖ Confidence Scorer (0-1)</div>
            <div class="arch-node l4">‚öñÔ∏è Reliability Weighter</div>
            <div class="arch-node l4">üéØ Corrected KPT Generator</div>
            <div class="arch-node l4">üì¶ Feature Store Writer</div>
          </div>
        </div>
        <div class="arch-connector">‚Üì Corrected Signal Output</div>

        <div class="arch-layer">
          <div class="arch-layer-label">Layer 5</div>
          <div class="arch-nodes">
            <div class="arch-node l4">üõµ Rider Dispatch Engine</div>
            <div class="arch-node l4">‚è±Ô∏è ETA Computation</div>
            <div class="arch-node l4">üì± Customer ETA Service</div>
            <div class="arch-node l4">üìä Ops Dashboard</div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid-2" style="margin-bottom:20px;">
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Key Innovations</div><div class="chart-subtitle">What differentiates QuantumTrio's approach</div></div></div>
        <div style="margin-top:12px;">
          ${[
            ['üî¨', 'Prep Gap Detector', 'Identifies rider-triggered FOR marking by correlating rider arrival time with merchant mark timing'],
            ['üìä', 'Reliability Scoring', 'Per-restaurant confidence index (0-1) based on historical bias and idle time patterns'],
            ['üî•', 'Kitchen Rush Proxy', 'Approximates total kitchen load (including dine-in) using observable Zomato signals only'],
            ['üèôÔ∏è', 'City-Scale Adapter', 'Normalizes KPT across Tier 1/2/3 cities using population density and congestion factors'],
            ['‚öñÔ∏è', 'Confidence-Weighted KPT', 'Feeds reliability-weighted signals to existing model ‚Äî no model redesign required'],
            ['‚ö°', 'Stream-First Design', 'Kafka-based real-time pipeline processes 5M+ daily orders with sub-second signal enrichment'],
          ].map(([icon, title, desc]) => `
            <div style="display:flex;gap:12px;margin-bottom:12px;padding:12px;background:var(--surface2);border-radius:8px;">
              <div style="font-size:20px;">${icon}</div>
              <div>
                <div style="font-family:var(--display);font-size:13px;font-weight:700;margin-bottom:2px;">${title}</div>
                <div style="font-size:11px;color:var(--muted);">${desc}</div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header"><div><div class="chart-title">Scalability Design</div><div class="chart-subtitle">300K+ merchants ¬∑ 1M+ riders</div></div></div>
        <div style="margin-top:12px;">
          <div style="background:var(--bg);border-radius:8px;padding:16px;font-family:var(--mono);font-size:11px;line-height:2;border:1px solid var(--border);">
            <div style="color:var(--accent2);">// Designed to scale passively</div>
            <div>Stream processing: <span style="color:var(--green);">Kafka + Flink</span></div>
            <div>Restaurant profiles: <span style="color:var(--green);">Rolling 7-day window</span></div>
            <div>Feature store: <span style="color:var(--green);">Redis + S3</span></div>
            <div>No hardware dependency: <span style="color:var(--green);">‚úì ZERO</span></div>
            <div>No model retraining: <span style="color:var(--green);">‚úì Signal-layer only</span></div>
            <div>Cold start support: <span style="color:var(--green);">City-level fallback</span></div>
            <div style="color:var(--accent2);margin-top:8px;">// India-scale targets</div>
            <div>Daily orders: <span style="color:var(--yellow);">5M+</span></div>
            <div>Merchants: <span style="color:var(--yellow);">300K ‚Üí 1M+</span></div>
            <div>Latency: <span style="color:var(--yellow);">&lt; 50ms signal correction</span></div>
            <div>Availability: <span style="color:var(--yellow);">99.9% SLA</span></div>
          </div>
          <div style="margin-top:14px;padding:14px;background:rgba(255,77,0,0.06);border-radius:8px;border:1px solid rgba(255,77,0,0.2);">
            <div style="font-size:12px;font-weight:600;color:var(--accent);margin-bottom:6px;">üí° Core Philosophy</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.6;">
              Don't fight the model ‚Äî fix the signal layer. We improve label quality <em>before</em> it reaches the KPT model. This is powerful because it works with any model, requires no retraining, and is inherently scalable.
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadOverview();
</script>
</body>
</html>
